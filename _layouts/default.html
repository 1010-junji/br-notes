<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">

{% seo %}
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKx3KibVwEYAVSjRRD8wGtfqbiXw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    {% include head-custom.html %}
  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">{{ page.title | default: site.title | default: site.github.repository_name }}</h1>
      <h2 class="project-tagline">{{ page.description | default: site.description | default: site.github.project_tagline }}</h2>

      {% if site.show_downloads %}
        <a href="{{ site.github.zip_url }}" class="btn">Download .zip</a>
        <a href="{{ site.github.tar_url }}" class="btn">Download .tar.gz</a>
      {% endif %}
    </header>

<!-- Modify -->
<main id="content" class="main-content" role="main">
  <div class="wrapper">
    <!-- 左カラム：グローバルメニュー -->
    <nav class="sidebar-nav">
      <h3>サイトメニュー</h3>
      <ul>
        <li><a href="{{ '/' | relative_url }}">ホーム</a></li>
        <li><a href="{{ '/RobotLifecycleManagement/' | relative_url }}">ロボットライフサイクル管理</a></li>
        <li><a href="{{ '/RobotLifecycleManagement/minimal-operation.html' | relative_url }}">最小構成での運用</a></li>
        <!-- ※ここにページのリンクを追加していく -->
      </ul>
    </nav>

    <!-- 中央カラム：メインコンテンツ -->
    <section class="main-column">
      {{ content }}
    </section>

    <!-- 右カラム：ページ内目次 -->
    <aside class="toc-sidebar">
      <h3>このページの目次</h3>
      <div id="toc"></div>
    </aside>
  </div>

  <footer class="site-footer">
    <div class="footer-content">
      <p>© 2025 BR-Notes by 1010-junji. All rights reserved.</p>
      <nav class="footer-nav">
        <ul>
          <li><a href="{{ '/' | relative_url }}">ホーム</a></li>
          <li><a href="https://github.com/1010-junji/br-notes">GitHub リポジトリ</a></li>
          <!-- 必要に応じて追加のリンク -->
        </ul>
      </nav>
      <p class="last-updated">最終更新: <span id="last-updated-date"></span></p>
    </div>
  </footer>
</main>
<!-- Modify -->
    
  <!-- Tocbotライブラリの読み込み -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.21.0/tocbot.min.js"></script>

  <!-- Tocbotの初期化スクリプト -->
  <script>
    tocbot.init({
      // 目次を生成する場所
      tocSelector: '#toc',
      // 目次の元となる見出しを探す場所
      contentSelector: '.main-column',
      // どのレベルの見出しを対象にするか (h2, h3)
      headingSelector: 'h2, h3',
      // スクロールに合わせてハイライトする
      hasInnerContainers: true
    });
  </script>

  <!-- GFM Callout 変換スクリプト -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const blockquotes = document.querySelectorAll('.main-column blockquote');
    
        blockquotes.forEach(blockquote => {
            const firstChild = blockquote.firstElementChild;
            if (firstChild && firstChild.tagName === 'P') {
                const text = firstChild.textContent.trim();
                const match = text.match(/^\[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*(.*)$/i);
    
                if (match) {
                    const type = match[1].toUpperCase(); // NOTE, TIP, IMPORTANT, WARNING, CAUTION
                    const content = match[2];
    
                    // blockquote の内容を新しい構造に変換
                    const newContentHtml = `<div class="callout-title"><i class="callout-icon"></i><span>${type}</span></div><div class="callout-body">${content}${blockquote.innerHTML.substring(firstChild.outerHTML.length)}</div>`;
                    blockquote.innerHTML = newContentHtml;
                    blockquote.classList.add('callout', `callout-${type.toLowerCase()}`); // CSSクラスを追加
                }
            }
        });
    
        // ページ最終更新日の取得と表示（オプション）
        // GitHub APIを叩くため、ビルド時に静的に埋め込む方が堅実ですが、
        // ここでは簡単にJSで動的に取得する例を示します。
        // もしGitHub Pagesがレート制限されるようなら、jekyll-last-modified-at などのプラグイン利用を検討ください。
        fetch('https://api.github.com/repos/1010-junji/br-notes/commits?per_page=1')
            .then(response => response.json())
            .then(data => {
                if (data && data.length > 0) {
                    const lastCommitDate = new Date(data[0].commit.committer.date);
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    document.getElementById('last-updated-date').textContent = lastCommitDate.toLocaleDateString('ja-JP', options);
                }
            })
            .catch(error => console.error('Error fetching last commit date:', error));
    });
    </script>
    
  </body>
</html>
