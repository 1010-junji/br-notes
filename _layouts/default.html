<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9XMBNYM465"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-9XMBNYM465');
    </script>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="/br-notes/assets/babyrobo128_1.ico" />

{% seo %}
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/syntax.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/nav.css?v=' | append: site.github.build_revision | relative_url }}">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKx3KibVwEYAVSjRRD8wGtfqbiXw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    {% include head-custom.html %}
  </head>
  <body>
    <div class="page-wrapper">
      <a id="skip-to-content" href="#content">Skip to the content.</a>
  
      <header class="page-header" role="banner">
        <h1 class="project-name">{{ page.title | default: site.title | default: site.github.repository_name }}</h1>
        <h2 class="project-tagline">{{ page.description | default: site.description | default: site.github.project_tagline }}</h2>
  
        {% if site.show_downloads %}
          <a href="{{ site.github.zip_url }}" class="btn">Download .zip</a>
          <a href="{{ site.github.tar_url }}" class="btn">Download .tar.gz</a>
        {% endif %}
      </header>
  
      <!-- Modify -->
      <main id="content" class="main-content" role="main">
        <div class="wrapper">
          <!-- 左カラム：グローバルメニュー
          <nav class="sidebar-nav">
            <h3>サイトメニュー</h3>
            <ul>
              <li><a href="{{ '/' | relative_url }}">ホーム</a></li>
              <li><a href="{{ '/RobotLifecycleManagement/' | relative_url }}">ロボット ライフサイクル マネジメント</a></li>
              <li><a href="{{ '/BizRobo-Keycloak/' | relative_url }}">KeycloakによるSSO</a></li>
            </ul>
          </nav>
           -->
          <nav class="sidebar-nav">
            <ul class="nav-root">
              {% assign current = page.url | default: '/' %}
              {% for item in site.data.nav %}
                <li class="nav-item">
                {% if item.children %}
                    
                    {% comment %} 現在のページのURLが、親アイテムのURLで始まっているかを確認 {% endcomment %}
                    {% assign is_current_section = false %}
                    {% if page.url contains item.url %}
                      {% assign is_current_section = true %}
                    {% endif %}

                    <details class.="nav-item-details" {% if is_current_section %}open{% endif %}>
                      <summary>
                        {% comment %} 
                          - 現在のページが親URLそのものなら 'active'
                          - 現在のページが子ページなら 'parent-active' を付与
                        {% endcomment %}
                        <a href="{{ item.url | relative_url }}" class="{% if page.url == item.url %}active{% elsif is_current_section %}parent-active{% endif %}">{{ item.title }}</a>
                        <span class="toggle"></span>
                      </summary>
                      <ul class="nav-children">
                        {% for child in item.children %}
                          <li class="nav-child">
                            <a href="{{ child.url | relative_url }}" class="{% if page.url == child.url %}active{% endif %}">
                              {{ child.title }}
                            </a>
                            <!-- DEBUG: [page.url = {{ page.url }}] vs [child.url = {{ child.url }}] -->
                          </li>
                        {% endfor %}
                      </ul>
                    </details>
                  
                  {% comment %} --- 子メニューを持たない要素の処理 --- {% endcomment %}
                  {% else %}
                    <a href="{{ item.url | relative_url }}"
                       class="{% if page.url == item.url %}active{% endif %}">
                      {{ item.title }}
                    </a>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </nav>
          
          <!-- 中央カラム：メインコンテンツ -->
          <section class="main-column">
            {{ content }}
          </section>
      
          <!-- 右カラム：ページ内目次 -->
          <aside class="toc-sidebar">
            <h3>このページの目次</h3>
            <div id="toc"></div>
          </aside>
        </div>
      </main>
      
      <footer class="site-footer">
        <div class="footer-content">
          <p>© 2025 BR-Notes by 1010-junji. All rights reserved.</p>
          <p class="last-updated">最終更新: <span id="last-updated-date"></span></p>
        </div>
      </footer>
      <!-- Modify -->
    </div>
    
    <!-- Tocbotライブラリの読み込み -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.21.0/tocbot.min.js"></script>
  
    <!-- Tocbotの初期化スクリプト -->
    <script>
      tocbot.init({
        // 目次を生成する場所
        tocSelector: '#toc',
        // 目次の元となる見出しを探す場所
        contentSelector: '.main-column',
        // どのレベルの見出しを対象にするか (h2, h3)
        headingSelector: 'h2, h3',
        // スクロールに合わせてハイライトする
        hasInnerContainers: true
      });
    </script>
  
    <!-- GFM Callout 変換スクリプト -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Callout変換処理 ---
        const blockquotes = document.querySelectorAll('.main-column blockquote');
    
        blockquotes.forEach(blockquote => {
            const firstP = blockquote.querySelector('p:first-of-type');
            if (!firstP) return; // 中にpタグがなければ何もしない
    
            const text = firstP.textContent.trim();
            // 正規表現でCalloutのシグネチャを探す
            const match = text.match(/^\[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*/i);
    
            if (match) {
                const type = match[1].toUpperCase();
    
                // 1. 新しいHTML要素をDOMオブジェクトとして作成
                const calloutTitle = document.createElement('div');
                calloutTitle.className = 'callout-title';
                const icon = document.createElement('i');
                icon.className = 'callout-icon';
                const titleText = document.createElement('span');
                titleText.textContent = type;
                calloutTitle.appendChild(icon);
                calloutTitle.appendChild(titleText);
    
                const calloutBody = document.createElement('div');
                calloutBody.className = 'callout-body';
    
                // 2. 最初のpタグから "[!NOTE]" の部分だけを削除する
                // innerHTMLを使って、中の<code>などのタグも維持する
                firstP.innerHTML = firstP.innerHTML.replace(/^\[!(?:NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*/i, '').trim();
    
                // 3. 元のblockquoteの子要素をすべて新しいcalloutBodyに移動する
                while (blockquote.firstChild) {
                    calloutBody.appendChild(blockquote.firstChild);
                }
    
                // 4. 空になったblockquoteに、新しい構造を挿入する
                blockquote.appendChild(calloutTitle);
                blockquote.appendChild(calloutBody);
    
                // 5. blockquote自体にクラスを追加してスタイルを適用
                blockquote.classList.add('callout', `callout-${type.toLowerCase()}`);
            }
        });
    
        // --- 最終更新日の取得処理（変更なし） ---
        fetch('https://api.github.com/repos/1010-junji/br-notes/commits?per_page=1')
            .then(response => response.json())
            .then(data => {
                if (data && data.length > 0) {
                    const lastCommitDate = new Date(data[0].commit.committer.date);
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    document.getElementById('last-updated-date').textContent = lastCommitDate.toLocaleDateString('ja-JP', options);
                }
            })
            .catch(error => console.error('Error fetching last commit date:', error));
    });
    </script>
      
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.esm.min.mjs';
    
      // 1. startOnLoadを 'false' に設定し、自動ロードを無効にする
      mermaid.initialize({ 
        startOnLoad: false 
      });
    
      // 2. DOMの準備が整った後に、描画対象のセレクタを指定して手動で実行する
      // querySelector: 'pre > code.language-mermaid' は、Markdownの ```mermaid ... ``` が変換された形です。
      document.addEventListener('DOMContentLoaded', async function() {
          await mermaid.run({
              querySelector: 'pre > code.language-mermaid', 
          });
      });
    </script>
    
  </body>
</html>
